<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>public/js/chat.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/modifiers.carga una animación y muestra un chat con sus mensajes.html">modifiers.carga una animación y muestra un chat con sus mensajes</a></li>
                                <li><a href="../classes/modifiers.Popper.html">modifiers.Popper</a></li>
                                <li><a href="../classes/modifiers.recoge las noticias con la categoria especificada y hace una animación.html">modifiers.recoge las noticias con la categoria especificada y hace una animación</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: public/js/chat.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
*@class carga una animación y muestra un chat con sus mensajes
*@author Adrián Cárdenas Lara (ACL)
*update 13/03/2018
*/


/**
*Variable global que determinará el tiempo
* @property timer
* @type int
* @default null
*/
var timer = null;


/**
 * @method mostrar
 * inicializa el timer, hace el efecto correspondiente y muestra los mensajes por chat
 */
function mostrar() {

    if( timer ){
        clearInterval(timer);
    }

    /**
     * @method setTimeout
     * ejecuta la funcion durante el tiempo especificado
     * @param efectoVisual {función} | timer {int}
     */
    setTimeout(efectoVisual,100);
    
    /**
     * @method setTimeout
     * ejecuta la funcion durante el tiempo especificado
     * @param function {función} | timer {int}
     */
    setTimeout(function(){
        esconderLogo();
        $(&#x27;#boxChat&#x27;).toggle(&quot;fast&quot;);
    },3000);

    /**
     * @method setInterval
     * ejecuta la funcion durante el tiempo especificado
     * @param mensajes {función} | timer {int}
     */
    timer = setInterval(mensajes,2000);

}


/**
 * @method ajaxChat
 * Recoge el mensaje que se acaba de mandar y el id del usuario que lo hizo
 * @param id 
 * @type int
*/

//ENVIA EL MENSAJE A LA BBDD
function ajaxChat(id){

     /**
      * funcion ajax que llama a una api y recoge el mensaje enviado
      * @property Ajax
      * @type API
     */
    $.ajax({
        type: &#x27;POST&#x27;,
        crossDomain: true,
        url: &#x27;api/ajaxRequest&#x27;,
        data: $(&#x27;#chatRoom&#x27;).serialize(),
        cache: false
    })
    .fail(
        /**
         * @method function
         * Devuelve un error si ha ido mal
         */
          function( jqXHR, textStatus, errorThrown ) {
          console.log( textStatus + errorThrown);
      }
    )
    .done( 
        /**
             * @method function
             * Executa la siguiente función si todo funciona
             */
        function() {
            console.log(&quot;consigue insertar&quot;);
            $(&#x27;#texto&#x27;).val(&quot; &quot;);
            mostrar();
        }
    );

}


 /**
 * @method mensajes
 * Recoge los mensajes por AJAX y los muestra 
 */
function mensajes(){

    /**
    *Variable que almacena el id del chat en el que se encuentra el usuario
    * @property idchat
    * @type int
    */
    var idchat = $(&#x27;#idChat&#x27;).val();

    /**
    *Variable que almacena el nombre del usuario
    * @property user
    * @type string 
    */
    var user = $(&#x27;#usuario&#x27;).val();



    $.ajax({
        type: &#x27;POST&#x27;,
        crossDomain: true,
        url: &#x27;api/recibirMensajes&#x27;,
        cache: false,
        data: {&quot;idchat&quot; : idchat, &quot;usuario&quot; : user},
        dataType: &quot;json&quot;
    }).fail(
          function( jqXHR, textStatus, errorThrown ) {
          console.log(&quot;no recibe nada&quot;);
      }
    ).done(
            /**
             * @method function
             * Executa la siguiente función si todo funciona
             * @param res {JSON}
             */
            function(res) {
            //console.log(res);
            console.log(&quot;Done del ajax&quot;);

            /**
            *Variable que contiene array con todos los mensajes
            * @property k
            * @type JSON
            */
            for(var k in res) {


                //Determina si un mensaje es TU usuario o de otro y crea la burbuja de mensaje en la dirección correspondiente
                
                if($(&#x27;#idMensaje&#x27;+k).length == 0 || $(&#x27;#idMensaje&#x27;+k).length == &quot;&quot; &amp;&amp; k == 0){
                    //console.log(&quot;Entra primer if: Check longitud mensajes&quot;);
                    if(res[k].id_user == user){
                        //console.log(&quot;Es igual al user&quot;);
                        $(&#x27;#content-mensajes&#x27;).append($(&#x27;&lt;div&gt;&#x27;,
                                                         {&#x27;class&#x27;:&#x27;bubble right&#x27;,
                                                          &#x27;id&#x27;:&#x27;idMensaje&#x27;+k
                                                        }).append($(&#x27;&lt;span&gt;&#x27;,{&#x27;style&#x27;: &#x27;margin-left: -83%; font-size: 25px&#x27;,&#x27;class&#x27;:&#x27;fa fa-user&#x27;}).text(res[k].usuario.name)).append($(&#x27;&lt;p&gt;&#x27;).text(res[k].mensaje))
                                                    );
                    }else{
                        //console.log(&quot;No es igual al user&quot;);
                        $(&#x27;#content-mensajes&#x27;).append($(&#x27;&lt;div&gt;&#x27;,
                                                        {&#x27;class&#x27;:&#x27;bubble left&#x27;,
                                                         &#x27;id&#x27;:&#x27;idMensaje&#x27;+k,
                                                         &#x27;style&#x27;:&#x27;background-color:red&#x27;
                                                        }).append($(&#x27;&lt;span&gt;&#x27;,{&#x27;style&#x27;: &#x27;margin-left: 83%; font-size: 25px&#x27;,&#x27;class&#x27;:&#x27;fa fa-user&#x27;}).text(res[k].usuario.name)).append($(&#x27;&lt;p&gt;&#x27;).text(res[k].mensaje))
                                                    );
                    }
                }
                    //console.log(&quot;Esto no se sabe bien bien que es WTF?&quot;);
                
            }
    });
}



 /**
 * @method cambiarChat
 * Cambia el de chat
 * @param  id 
 * @type int
 */
function cambiarChat( id ){
    
  
    // esconde el chat 
    
    $(&#x27;#boxChat&#x27;).hide(&quot;fast&quot;);

    
    //muestra el dibujo que hace la animación

    $(&#x27;#svgAttributes&#x27;).toggle(&quot;fast&quot;);



    /**
    * variable que recoge el id del barrio/chat al que entra
    * @property sala
    * @type string
    */
    var sala = $(&#x27;#&#x27;+id).val();


    
    //Crea un elemento JQuery con el texto de la variable anterior
    
    $(&#x27;#tituloSala&#x27;).attr(&#x27;class&#x27;, &#x27;fa fa-group&#x27;);
    $(&#x27;#tituloSala&#x27;).text(sala);

    
    // Si es el primer chat que se crea
    
    if($(&#x27;#idChat&#x27;).val() == 0){
        $(&#x27;#idChat&#x27;).attr({&#x27;value&#x27;:id , &#x27;data-active&#x27;:&#x27;y&#x27;});
    }else{
    
    //o si ya existe, vacia el div 
    
        $(&#x27;#content-mensajes&#x27;).empty();
        $(&#x27;#idChat&#x27;).attr({&#x27;value&#x27;:id , &#x27;data-active&#x27;:&#x27;y&#x27;});

    }


    mostrar();  
}



/**
* @method salirChat
* Hace un efecto de fadeOut en el chat y resetea el timer a 0
*/
function salirChat(){
    $(&#x27;#boxChat&#x27;).fadeOut(1600);
    if( timer ){
        clearInterval(timer);
    }
}


 /**
 * @method efectoVisual
 * Hace un efecto visual
 */
function efectoVisual(){
    /**
     * Variable que ejecuta la animación
     * @property svgAttributes
     * @type anime
    */
    var svgAttributes = anime({
    //a quien afecta
      targets: &#x27;#svgAttributes polygon&#x27;,
    //extender el SVG en esos puntos
      points: &#x27;64 128 8.574 96 8.574 32 64 0 119.426 32 119.426 96&#x27;,
    //el efecto que realiza
      easing: &#x27;easeInOutExpo&#x27;,
    // realizar el mismo efecto pero a la inversa
      direction: &#x27;alternate&#x27;,
    //la duración de la animación
      duration: 1050,
    //si se repite o no 
      loop: true
    });
}



 /**
 * @method esconderLogo
 * ESconde el SVG
 */
function esconderLogo(){
    $(&#x27;#svgAttributes&#x27;).hide(&quot;fast&quot;);
}


    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
